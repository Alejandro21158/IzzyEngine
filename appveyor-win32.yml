version: "{build}"
environment:
  global:
    HAXELIB_ROOT: C:\projects\haxelib
    WXWIN: C:\wxWidgets
only_commits:
  files:
    - source/
install:
  # http://help.appveyor.com/discussions/problems/5616-not-able-to-build-due-to-problem-in-chocolateyinstallps1
  - ps: Set-Service wuauserv -StartupType Manual
  # Install and configure wxWidgets
  - mkdir %WXWIN%
  - ps: Invoke-WebRequest -Uri "https://github.com/wxWidgets/wxWidgets/releases/download/v3.1.5/wxWidgets-3.1.5.zip" -OutFile "$env:WXWIN\wxWidgets-3.1.5.zip"
  - cd %WXWIN%
  - ps: Expand-Archive -Force wxWidgets-3.1.5.zip .
  - call "C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Auxiliary\Build\vcvars32.bat"
  - cd build\msw
  - nmake.exe -f makefile.vc BUILD=release
  - cd C:\projects\IzzyEngine
  # Install the haxe chocolatey package (https://chocolatey.org/packages/haxe)
  - cinst haxe --version 4.2.2 -y
  - RefreshEnv
  # Setup haxelib
  - mkdir "C:\projects\haxelib"
  - haxelib setup "C:\projects\haxelib"
  # Install project dependencies
  - haxelib install hscript  > log.txt || type log.txt && cmd /C exit 1
  - haxelib git discord_rpc https://github.com/Aidan63/linc_discord-rpc  > log.txt || type log.txt && cmd /C exit 1
  - haxelib install lime  > log.txt || type log.txt && cmd /C exit 1
  - haxelib install openfl  > log.txt || type log.txt && cmd /C exit 1
  - haxelib install flixel  > log.txt || type log.txt && cmd /C exit 1
  - haxelib run lime setup flixel  > log.txt || type log.txt && cmd /C exit 1
  - haxelib run lime setup  > log.txt || type log.txt && cmd /C exit 1
  - haxelib git haxeui-core https://github.com/haxeui/haxeui-core  > log.txt || type log.txt && cmd /C exit 1
  - haxelib git haxeui-hxwidgets https://github.com/haxeui/haxeui-hxwidgets  > log.txt || type log.txt && cmd /C exit 1
  - haxelib git hxWidgets https://github.com/haxeui/hxWidgets  > log.txt || type log.txt && cmd /C exit 1
  - haxelib list
  
build_script:
  - haxelib run lime build windows -32
artifacts:
  - path: crash-dialog/build/windows/Main.exe
    name: CrashHandler
    type: zip
